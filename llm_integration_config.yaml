# Simple LLM Integration Setup for Crop Steering System
# This replaces the complex llm_integration_config.yaml with user-friendly defaults

# Step 1: Get Your API Key
# • OpenAI: Visit https://platform.openai.com/api-keys
# • Claude: Visit https://console.anthropic.com/

# Step 2: Add API key to secrets.yaml
# Add this line to your secrets.yaml file:
# openai_api_key: "sk-your-actual-key-here"
# OR
# claude_api_key: "sk-ant-your-actual-key-here"

# Step 3: Add to AppDaemon apps.yaml
# Copy this section to your /config/appdaemon/apps/apps.yaml:

llm_enhanced_crop_steering:
  module: crop_steering.llm.llm_enhanced_app
  class: LLMEnhancedCropSteering

  # Basic Setup
  zones: [1, 2, 3]        # CHANGE THIS: List your zone numbers
  enable_llm: true        # Set to false to disable LLM features

  # LLM Configuration (RECOMMENDED DEFAULTS)
  llm_config:
    provider: "openai"                    # or "claude"
    model: "gpt-4o-mini"                 # Most cost-effective option ($0.15/$0.60 per 1M tokens)
    api_key: !secret openai_api_key      # References your secrets.yaml
    timeout: 30
    max_retries: 3

  # Budget Control (IMPORTANT!)
  budget_config:
    daily_limit: 2.0      # $2 per day limit (adjust as needed)
    cost_tier: "standard" # Options: "economy", "standard", "premium"
    enable_alerts: true   # Get notified when approaching limits

  # Decision Settings
  llm_confidence_threshold: 70.0        # Only trust LLM if >70% confident
  enable_llm_phase_transitions: true    # Allow LLM to suggest phase changes

  # Safety Limits (CRITICAL - Don't change unless you know what you're doing)
  safety_thresholds:
    min_confidence: 70.0
    max_vwc_critical: 80.0    # Emergency stop if VWC > 80%
    min_vwc_critical: 40.0    # Emergency irrigation if VWC < 40%
    emergency_response_time: 300  # 5 minutes max for emergency response

---

# Alternative Model Options (pick ONE):

# OPTION 1: Ultra Budget (Claude Haiku)
# llm_config:
#   provider: "claude"
#   model: "claude-3-haiku-20240307"     # $0.25/$1.25 per 1M tokens
#   api_key: !secret claude_api_key
#   daily_limit: 1.0  # $1 per day

# OPTION 2: High Quality (GPT-4o)  
# llm_config:
#   provider: "openai"
#   model: "gpt-4o"                      # $5/$15 per 1M tokens
#   api_key: !secret openai_api_key
#   daily_limit: 5.0  # $5 per day

# OPTION 3: Premium (Claude Sonnet)
# llm_config:
#   provider: "claude" 
#   model: "claude-3-5-sonnet-20241022"  # $3/$15 per 1M tokens
#   api_key: !secret claude_api_key
#   daily_limit: 3.0  # $3 per day

---

# Quick Start Checklist:
# ☐ Get API key from OpenAI or Anthropic
# ☐ Add key to secrets.yaml  
# ☐ Update zones list above
# ☐ Copy config to apps.yaml
# ☐ Restart AppDaemon
# ☐ Test with: crop_steering.test_llm_api_key service
# ☐ Monitor costs with built-in sensors

# Cost Reality Check:
# • 100 decisions/day with gpt-4o-mini ≈ $0.10-0.30/day
# • 100 decisions/day with claude-haiku ≈ $0.15-0.40/day  
# • Caching can reduce costs by 70-90% after first week
# • Emergency-only mode: <$0.05/day

# Troubleshooting:
# • "API key invalid" → Check secrets.yaml and key format
# • "High costs" → Reduce budget_config.daily_limit
# • "LLM not working" → Check AppDaemon logs for errors
# • "No decisions" → Check confidence threshold (lower = more LLM usage)
